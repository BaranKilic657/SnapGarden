<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SnapGarden - Dashboard</title>
    <!-- Favicon icon -->
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon.png">
    <!-- Custom Stylesheet -->
    <link href="./plugins/fullcalendar/css/fullcalendar.min.css" rel="stylesheet">
    <link href="css/style2.css" rel="stylesheet">
</head>

<body>

    <!--*******************
        Preloader start
    ********************-->
    <div id="preloader">
        <div class="loader">
            <svg class="circular" viewBox="25 25 50 50">
                <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="3" stroke-miterlimit="10" />
            </svg>
        </div>
    </div>
    <!--*******************
        Preloader end
    ********************-->

    <!--**********************************
        Main wrapper start
    ***********************************-->
    <div id="main-wrapper">

        <!--**********************************
            Nav header start
        ***********************************-->
        <div class="nav-header" style="background-color: whitesmoke;">
            <div class="brand-logo">
                <a href="dashboard.html">
                    <b class="logo-abbr"><img src="images/logo2.png" alt=""> </b>
                    <span class="logo-compact"><img src="./images/logo-compact.png" alt=""></span>
                    <span class="brand-title">
                        <img src="images/logo-text.png" alt="" style="width: 200px; height: auto; position: relative; left: -10px;">
                    </span>
                </a>
            </div>
        </div>
        <!--**********************************
            Nav header end
        ***********************************-->

        <!--**********************************
            Header start
        ***********************************-->
        <div class="header" style="background-color: beige;">
            <div class="header-content clearfix">
                
                <div class="nav-control">
                    <div class="hamburger">
                        <span class="toggle-icon"><i class="icon-menu"></i></span>
                    </div>
                </div>

                <div class="header-right">
                    <ul class="clearfix">
                        <li class="icons dropdown">
                            <div class="user-img c-pointer position-relative"   data-toggle="dropdown">
                                <span class="activity active"></span>
                                <img src="images/user/1.png" height="40" width="40" alt="">
                            </div>
                            <div class="drop-down dropdown-profile animated fadeIn dropdown-menu">
                                <div class="dropdown-content-body">
                                    <ul>
                                        <li><a href="sign-in.html"><i class="icon-key"></i> <span>Logout</span></a></li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!--**********************************
            Header end ti-comment-alt
        ***********************************-->

        <!--**********************************
            Sidebar start
        ***********************************-->
        <div class="nk-sidebar">           
            <div class="nk-nav-scroll">
                <ul class="metismenu" id="menu">
                    <li class="nav-label">Dashboard</li>
                    <li>
                        <a href="dashboard.html" aria-expanded="false">
                            <i class="ti-dashboard menu-icon"></i>
                            <span class="nav-text">Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-label">Identification</li>
                    <li>
                        <a href="plantid.html" aria-expanded="false">
                            <i class="ti-palette  menu-icon"></i>
                            <span class="nav-text">Plant Identification</span>
                        </a>
                    </li>
                    <li class="nav-label">Apps</li>
                    <li>
                        <a href="./chat.html" aria-expanded="false">
                            <i class="ti-comments menu-icon"></i>
                            <span class="nav-text">Chat</span>
                        </a>
                    </li>
                    <li>
                        <a href="./app-calender.html" aria-expanded="false">
                            <i class="ti-calendar menu-icon"></i>
                            <span class="nav-text">Calendar</span>
                        </a>
                    </li>
                    <li>
                        <a href="./chart-chartist.html" aria-expanded="false">
                            <i class="ti-bar-chart menu-icon"></i>
                            <span class="nav-text">Charts</span>
                        </a>
                    </li>
                    <li class="nav-label">Table</li>
                    <li>
                        <a href="table-datatable.html" aria-expanded="false">
                            <i class="ti-layout-menu-v menu-icon"></i>
                            <span class="nav-text">Datatable</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <!--**********************************
            Sidebar end
        ***********************************-->

        <!--**********************************
            Content body start
        ***********************************-->
        <div class="content-body d-flex justify-content-center align-items-center" style="min-height: 100vh; position: relative; background-image: url('images/background1.png'); background-size: cover; background-position: center;">
            <div class="container-fluid">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title text-center">Chat with SnapGarden</h4>
                                
                                <!-- ADDITION (display:flex + flex-direction for #chat-box) -->
                                <div 
                                  id="chat-box" 
                                  style="
                                       border: 1px solid beige; 
                                       border-radius: 10px; 
                                       padding: 15px; 
                                       height: 400px; 
                                       overflow-y: auto; 
                                       background-color: #f9f9f9;
                                       display: flex; 
                                       flex-direction: column;
                                  "
                                >
                                    <!-- Messages will appear here -->
                                </div>

                                <form id="chat-form" class="mt-3 d-flex">
                                    <input 
                                        type="text" 
                                        id="question" 
                                        name="question" 
                                        class="form-control" 
                                        placeholder="Type your message here..." 
                                        required
                                        style="border-radius: 20px; margin-right: 10px;">
                                    <button 
                                        type="submit" 
                                        class="btn btn-success" 
                                        style="border-radius: 20px;">Send</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    <!--**********************************
        Content body end
    ***********************************-->
    </div>
    <!--**********************************
        Main wrapper end
    ***********************************-->

    <!--**********************************
        Scripts
    ***********************************-->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="plugins/common/common.min.js"></script>
    <script src="js/custom.min.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/gleek.js"></script>
    <script src="js/styleSwitcher.js"></script>
    <script src="./plugins/jqueryui/js/jquery-ui.min.js"></script>
    <script src="./plugins/moment/moment.min.js"></script>
    <script>
        document.getElementById('chat-form').addEventListener('submit', async (event) => {
            event.preventDefault();
        
            const questionInput = document.getElementById('question');
            const chatBox = document.getElementById('chat-box');
        
            // --------------------------
            // 1) User message (LEFT)
            // --------------------------
            const userMessage = document.createElement('div');
            userMessage.textContent = questionInput.value;
        
            userMessage.style.cssText = `
                background-color: #32cd32;
                color: white;
                padding: 10px;
                border-radius: 10px;
                margin-bottom: 10px;
                align-self: flex-start;    /* Left side in a column flex */
                max-width: 75%;
            `;
            userMessage.classList.add('d-flex', 'justify-content-start'); 
        
            chatBox.appendChild(userMessage);
            chatBox.scrollTop = chatBox.scrollHeight;
        
            // Prepare form data
            const formData = new FormData();
            formData.append('question', questionInput.value);
        
            questionInput.value = '';
        
            try {
                // POST to FastAPI
                const response = await axios.post('http://localhost:8000/analyze', formData, {
                    headers: { 'Content-Type': 'multipart/form-data' },
                });
        
                // --------------------------
                // 2) AI answer (RIGHT)
                // --------------------------
                const aiMessage = document.createElement('div');
                aiMessage.textContent = response.data.answer;
        
                aiMessage.style.cssText = `
                    background-color: #e9ecef;
                    color: black;
                    padding: 10px;
                    border-radius: 10px;
                    margin-bottom: 10px;
                    align-self: flex-end;     /* Right side in a column flex */
                    max-width: 75%;
                `;
                aiMessage.classList.add('d-flex', 'justify-content-end'); 
        
                chatBox.appendChild(aiMessage);
                chatBox.scrollTop = chatBox.scrollHeight;
            } catch (error) {
                console.error('Error:', error);
        
                const errorMessage = document.createElement('div');
                errorMessage.textContent = 'An error occurred while processing your request.';
                errorMessage.style.cssText = `
                    background-color: #dc3545;
                    color: white;
                    padding: 10px;
                    border-radius: 10px;
                    margin-bottom: 10px;
                    align-self: flex-end;
                    max-width: 75%;
                `;
                errorMessage.classList.add('d-flex', 'justify-content-end');
        
                chatBox.appendChild(errorMessage);
                chatBox.scrollTop = chatBox.scrollHeight;
            }
        });
    </script>
        
</body>

</html>